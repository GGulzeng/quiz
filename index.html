
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ì˜ì–´ ë¬¸ì¥ í€´ì¦ˆ</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f4f4f4; }
    h1 { color: #333; }
    .level-buttons { margin-bottom: 1.5rem; }
    .level-buttons button {
      padding: 0.6rem 1.2rem; margin-right: 1rem;
      font-size: 1rem; border: none;
      background-color: #007bff; color: white;
      border-radius: 6px; cursor: pointer;
    }
    .quiz-box { background: white; padding: 1rem; margin-bottom: 2rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .kor-question { font-size: 1.2rem; margin-bottom: 1rem; }
    .choices { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 1rem; }
    .choice { background: #e0e0e0; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; }
    .assembled { min-height: 40px; margin-bottom: 1rem; border: 1px dashed #aaa; padding: 0.5rem; border-radius: 4px; background: #fff; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 10; }
    .modal-content { background: white; padding: 2rem; border-radius: 8px; text-align: center; min-width: 300px; }
    #countdown { font-size: 1.2rem; margin-top: 1rem; color: #d00; }
  </style>
</head>
<body>
  <h1>ì˜ì–´ ë¬¸ì¥ í€´ì¦ˆ</h1>
  <div class="level-buttons">
    <button onclick="startQuiz('Level 1')">Level 1</button>
    <button onclick="startQuiz('Level 2')">Level 2</button>
    <button onclick="startQuiz('Level 3')">Level 3</button>
  </div>

  <div id="quiz-container" class="quiz-box"></div>

  <div class="modal" id="modal-correct">
    <div class="modal-content">
      <h2 id="result-text"></h2>
      <p id="result-kor"></p>
      <button onclick="playTTS()">ğŸ”Š ë‹¤ì‹œ ë“£ê¸°</button>
      <button onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
      <div id="countdown">15</div>
    </div>
  </div>

  <div class="modal" id="modal-wrong">
    <div class="modal-content">
      <h2>âŒ í‹€ë ¸ìŠµë‹ˆë‹¤.</h2>
      <p><b>íŒíŠ¸:</b> <span id="hint-text"></span></p>
      <button onclick="closeWrongModal()">ë‹¤ì‹œ í’€ê¸°</button>
    </div>
  </div>

  <script>
    let quizzes = [];
    let levelQuizzes = [];
    let current = 0;
    let assembledWords = [];
    let countdownInterval;

    fetch("quiz_sentence.json")
      .then(res => res.json())
      .then(data => {
        quizzes = data;
        console.log("í€´ì¦ˆ ë¡œë”© ì™„ë£Œ:", quizzes.length);
      });

    function startQuiz(level) {
      if (!quizzes.length) {
        alert("í€´ì¦ˆ ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."); return;
      }
      console.log("ì„ íƒëœ ë ˆë²¨:", level);
      levelQuizzes = quizzes.filter(q => q.level === level).sort(() => Math.random() - 0.5);
      console.log("í•´ë‹¹ ë ˆë²¨ í€´ì¦ˆ ìˆ˜:", levelQuizzes.length);
      current = 0;
      renderQuiz();
    }

    function renderQuiz() {
      const q = levelQuizzes[current];
      const container = document.getElementById('quiz-container');
      container.innerHTML = `
        <div class="kor-question"><b>Q${q.id}. ${q.kor}</b></div>
        <div class="assembled" id="assembled"></div>
        <div class="choices">
          ${q.choices.map(word => `<div class="choice" onclick="addWord(this)">${word}</div>`).join('')}
        </div>
        <button onclick="checkAnswer()">ì œì¶œ</button>
        <button onclick="resetAssembled()">ì´ˆê¸°í™”</button>
        <button onclick="showAnswer()">ì •ë‹µë³´ê¸°</button>
      `;
      assembledWords = [];
    }

    function addWord(el) {
      assembledWords.push(el.innerText);
      document.getElementById('assembled').innerText = assembledWords.join(" ");
    }

    function resetAssembled() {
      assembledWords = [];
      document.getElementById('assembled').innerText = "";
    }

    function checkAnswer() {
      const q = levelQuizzes[current];
      const isCorrect = assembledWords.join(" ").trim() === q.correct.join(" ").trim();
      if (isCorrect) {
        showAnswer();
      } else {
        document.getElementById('hint-text').innerText = q.hint.join(" ");
        document.getElementById('modal-wrong').style.display = 'flex';
      }
    }

    function showAnswer() {
      const q = levelQuizzes[current];
      document.getElementById('result-text').innerText = q.correct.join(" ");
      document.getElementById('result-kor').innerText = q.kor;
      document.getElementById('modal-correct').style.display = 'flex';
      playTTS();
      startCountdown();
    }

    function playTTS() {
      const q = levelQuizzes[current];
      const audio = document.getElementById("ttsPlayer");
      audio.src = "tts_mp3/sentence_" + (current + 1) + ".mp3";
      audio.play();
    }

    function nextQuestion() {
      clearInterval(countdownInterval);
      document.getElementById('modal-correct').style.display = 'none';
      document.getElementById('modal-wrong').style.display = 'none';
      current++;
      if (current < levelQuizzes.length) {
        renderQuiz();
      } else {
        alert("í€´ì¦ˆê°€ ëë‚¬ì–´ìš”!");
      }
    }

    function closeWrongModal() {
      document.getElementById('modal-wrong').style.display = 'none';
    }

    function startCountdown() {
      let timeLeft = 15;
      document.getElementById('countdown').innerText = timeLeft;
      countdownInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('countdown').innerText = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(countdownInterval);
          nextQuestion();
        }
      }, 1000);
    }
  </script>
<audio id="ttsPlayer" src="" preload="auto"></audio>
</body>
</html>
